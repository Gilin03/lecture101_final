<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<!-- 사용자 CSS 추가 -->
<!-- 카카오 로그인 SDK 추가 -->
<head>
  <meta charset="utf-8" />
  <title>Kakao JavaScript SDK</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    // SDK를 초기화 합니다. 사용할 앱의 JavaScript 키를 설정해 주세요.
    Kakao.init('61eda696b217aedf96e2e8073b9dcebc'); //★ 수정 할 것

    // SDK 초기화 여부를 판단합니다.
    console.log(Kakao.isInitialized());
  </script>
</head>

<body>


<div layout:fragment="content">

  <form role="form" method="post" action="/members/login">
    <div class="form-group">
      <label th:for="email">이메일주소</label>
      <input type="email" name="email" class="form-control" placeholder="이메일을 입력해주세요">
    </div>
    <div class="form-group">
      <label th:for="password">비밀번호</label>
      <input type="password" name="password" id="password" class="form-control" placeholder="비밀번호 입력">
    </div>
    <p th:if="${loginErrorMsg}" class="error" th:text="${loginErrorMsg}"></p>
    <button class="btn btn-primary">로그인</button>
    <button type="button" class="btn btn-primary" onClick="location.href='/members/new'">회원가입</button>
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
  </form>

<table>
  <tr>
    <td>
      <a id="custom-login-btn" href="javascript:loginWithKakao()"><img src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg" width="222" /></a>
    </td>
  </tr>
  <tr>
    <td>
      <input id="logout" type="button" value="LogOut" onclick="javascript:logoutWithKakao()" />
    </td>
  </tr>
  </table>


  <p id="token-result"></p>
  <script type="text/javascript">
    function loginWithKakao() {
      Kakao.Auth.authorize({
        redirectUri: 'http://localhost/members/login'

      })
    }
    // 아래는 데모를 위한 UI 코드입니다.
    displayToken()
    function displayToken() {
      const token = getCookie('authorize-access-token')
      if (token) {
        Kakao.Auth.setAccessToken(token)
        Kakao.Auth.getStatusInfo(({ status }) => {
          if (status === 'connected') {
            document.getElementById('token-result').innerText = 'login success. token: ' + Kakao.Auth.getAccessToken()

            // 로그아웃 버튼 활성화
            displayLogout();

            // 프로필 조회


          } else {
            Kakao.Auth.setAccessToken(null)
          }
        })
      }
    }
    function getCookie(name) {
      const value = "; " + document.cookie;
      const parts = value.split("; " + name + "=");
      if (parts.length === 2) return parts.pop().split(";").shift();
    }

    //로그아웃
    function logoutWithKakao() {
      if (!Kakao.Auth.getAccessToken()) {
        console.log('Not logged in.');
        return;
      }
      Kakao.Auth.logout(function () {
        console.log(Kakao.Auth.getAccessToken());
      });
      displayLogout();
    }
    // 아래는 데모를 위한 UI 코드입니다.
    function displayLogout(){
      if (!Kakao.Auth.getAccessToken()) {
        document.getElementById('logout').disabled = true;
        console.log('Not logged in.');
        return;
      }

      document.getElementById('logout').disabled = false;
    }

  </script>
</body>

</div>

</html>
